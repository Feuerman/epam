var events={},productsCtrl,product;$(function(){productsCtrl=new ProductController,products=productsCtrl.products,productsCtrl.showProducts(products),$(".tablesorter").tablesorter({headers:{0:{sorter:"text"},1:{sorter:!1},2:{sorter:"digit"},3:{sorter:!1}}}),$("body").on("click",".add",events.addProduct),$("body").on("click",".edit",events.editProduct),$("body").on("click",".remove",events.removeProduct),$("button.search").on("click",events.search),$("button.showAll").on("click",events.showAll),$("body").on("focus","#price",events.inPrice),$("body").on("blur","#price",events.outPrice)});
events.addProduct=function(){$.ajax({url:"/epam/build/templates/formProduct.html",cache:!0,success:function(t){var e,t=t.replace(/(?:\r\n|\r|\n)/g,""),o=function(t){if(e.valid()){var o=new Product({name:$("#name").val(),count:+$("#count").val(),price:+$("#price").val().replace(/(\$|,)/g,"")});o=productsCtrl.addProduct(o),productsCtrl.addRow(o),notifyShow.showSuccess("New product added"),t.close()}};showModal.showDialog({title:"Add new",message:t,buttons:[{label:"Add",cssClass:"btn-primary",action:o},{label:"Close",cssClass:"btn-primary",action:function(t){t.close()}}],onshown:function(){e=$("form.add-new"),e.validate(regulations)}})}})},events.editProduct=function(){var t=$(this),e=+t.attr("product-id"),o=productsCtrl.getById(e);$.ajax({url:"/epam/build/templates/formProduct.html",cache:!0,success:function(e){var e=e.replace(/(?:\r\n|\r|\n)/g,""),r=$(e);r.find("#name").val(o.name),r.find("#price").val(o.price.moneyFormat()),r.find("#count").val(o.count);var s=function(e){r.valid()&&(o.name=$("#name").val(),o.count=+$("#count").val(),o.price=+$("#price").val().replace(/(\$|,)/g,""),productsCtrl.editProduct(o),t.closest("tr").remove(),$(".tablesorter").trigger("update"),productsCtrl.addRow(o),notifyShow.showSuccess("Product edited"),e.close())};showModal.showDialog({title:"Edit product",message:r,buttons:[{label:"Update",cssClass:"btn-primary",action:s},{label:"Close",cssClass:"btn-primary",action:function(t){t.close()}}],onshown:function(){r.validate(regulations)}})}})},events.removeProduct=function(){var t=$(this);showModal.showDialog({title:"Removal confirmation",message:"Remove items?",buttons:[{label:"Yes",cssClass:"btn-danger",action:function(e){var o=+t.attr("product-id");productsCtrl.removeProduct(o),t.closest("tr").remove(),$(".tablesorter").trigger("update"),notifyShow.showSuccess("Product deleted"),e.close()}},{label:"No",cssClass:"btn-primary",action:function(t){t.close()}}]})},events.search=function(){var t=$("input.search").val();if(!t)return void notifyShow.showError("Please, enter the query");var e=productsCtrl.searchByName(t);productsCtrl.showProducts(e)},events.showAll=function(){$("input.search").val(""),productsCtrl.showProducts(products)};var showModal=function(){return{showDialog:function(t){BootstrapDialog.show(t)}}}(),notifyShow=function(){var t=function(t,e){$(".notification").notify({message:{text:t},type:e}).show()};return{showError:function(e){t(e,"danger")},showSuccess:function(e){t(e,"success")},showInfo:function(e){t(e,"info")}}}(),regulations={rules:{name:{required:!0,pattern:/\S/,maxlength:15},price:{validPrice:!0}},messages:{name:{pattern:"The field can not consist solely of spaces"},price:{validPrice:"Enter the number"}}},options={highlight:function(t){$(t).parents(".form-group").removeClass("has-success").addClass("has-error")},unhighlight:function(t){$(t).parents(".form-group").removeClass("has-error")},errorElement:"span",errorPlacement:function(t,e){t.insertAfter(e)}};$.validator.setDefaults(options),$.validator.addMethod("pattern",function(t,e,o){return o.test(t)}),$.validator.addMethod("validPrice",function(t){return!isNaN(+t.replace(/(\$|,)/g,""))}),events.inPrice=function(){this.value=this.value.replace(/(\$|,)/g,"")},events.outPrice=function(){var t=+this.value;isNaN(t)||(this.value=t.moneyFormat())};
function Product(t){this.name=t.name,this.count=+t.count,this.price=+t.price}function ProductController(){this.counter=1,this.products=[],this.addProduct(new Product({name:"Keyboard",count:57,price:200})),this.addProduct(new Product({name:"Mouse",count:30,price:120.21})),this.addProduct(new Product({name:"Monitor",count:95,price:1280})),this.addProduct(new Product({name:"Gamepad",count:43,price:280})),this.addProduct(new Product({name:"CPU",count:18,price:1500.55}))}ProductController.prototype.addProduct=function(t){return t.id=this.counter++,this.products.push(t),t},ProductController.prototype.editProduct=function(t){var o=this.getById(t.id);o.name=t.name,o.count=t.count,o.price=t.price},ProductController.prototype.removeProduct=function(t){var o=this.products.getIndex("id",t);this.products.splice(o,1)},Array.prototype.getIndex=function(t,o){for(var r=0;r<this.length;r++)if(this[r][t]===o)return r},ProductController.prototype.showProducts=function(t){container=$(".products-table tbody"),$(container).empty();for(var o=0;o<=t.length-1;o++)this.addRow(t[o])},ProductController.prototype.searchByName=function(t){return this.products.filter(function(o){return o.name.toLowerCase().indexOf(t.toLowerCase())>-1})},ProductController.prototype.getById=function(t){return products.filter(function(o){return o.id===t})[0]},ProductController.prototype.addRow=function(t){var o="<tr><td>"+t.name+"</td><td>"+t.count+"</td><td>"+t.price+'</td><td class="text-center"><span class="glyphicon glyphicon-edit edit" product-id="'+t.id+'" title="Update"></span><span class="glyphicon glyphicon-remove remove" product-id="'+t.id+'" title="Delete"></span></td></tr>';$(container).append(o)},Number.prototype.moneyFormat=function(){return"$"+this.toFixed(2).replace(/./g,function(t,o,r){return o&&"."!==t&&(r.length-o)%3===0?","+t:t})};